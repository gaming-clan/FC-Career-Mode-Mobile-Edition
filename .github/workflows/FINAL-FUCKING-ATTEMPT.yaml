name: FINAL ATTEMPT - EAS Android Build

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 18

      - name: Install pnpm
        run: npm install -g pnpm

      - name: Install deps
        run: pnpm install --frozen-lockfile

      - name: Install EAS CLI
        run: npm install -g eas-cli

      - name: Ensure EAS auth
        env:
          EXPO_TOKEN: ${{ secrets.TEST_ROBOT }}
        run: |
          echo "EAS whoami:" && eas whoami || true

      - name: Init EAS project (non-interactive)
        env:
          EXPO_TOKEN: ${{ secrets.TEST_ROBOT }}
        run: |
          set -e
          echo "Running eas init --non-interactive"
          eas init --non-interactive --force || true

      - name: Run EAS build (tiny comment added)
        # tiny change: added this one-line comment to test CI re-run
        env:
          EXPO_TOKEN: ${{ secrets.TEST_ROBOT }}
        run: |
          eas build -p android --profile production --non-interactive
